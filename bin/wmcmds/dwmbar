#!/bin/sh

ftodo()
{
	rtodo=$(todo | sed '/^[[:space:]]*$/d' | wc -l | sed 's/0//g')
	[ "${rtodo}" != "" ] && echo "ğŸ“ ${rtodo} | "
}

fappointments()
{
	rappointments=$(appointments)
	[ "${rappointments}" != "" ] && echo "ğŸ“… ${rappointments} | "
}

fnews()
{
	rnews=$(news)
	[ "${rnews}" != "" ] && echo "ğŸ“° ${rnews} | "
}

fpacpackages()
{
	rpac=$(pacpackages)
	[ "${rpac}" != "" ] && echo "ğŸ“¦ ${rpac} | "
}

fweather()
{
	rweather=$(weather)
	[ "${rweather}" != "" ] && echo "${rweather} | "
}

fmailbox()
{
	rbox=$(mailbox)
	[ "${rbox}" != "" ] && echo "ğŸ“¬ ${rbox} | "
}

fbattery()
{
	capacity=$(cat /sys/class/power_supply/"$1"/capacity) || exit
	status=$(cat /sys/class/power_supply/"$1"/status)

	[ "${capacity}" -lt 25 ] && warn="â—" || warn=" "
	printf "%s%s%s" "$(echo "$status" | sed -e "s/,//;s/Discharging/ğŸ”‹/;s/Not Charging/ğŸ›‘/;s/Charging/ğŸ”Œ/;s/Unknown/â™»ï¸/;s/Full/âš¡/;s/ 0*/ /g;s/ :/ /g")" "$warn" "$(echo "$capacity" | sed -e 's/$/%/')"
}

while true; do
	xsetroot -name "$(fappointments)$(ftodo)$(fnews)$(fmailbox)$(fpacpackages)$(fweather)$(volume) | $(internet) | $(fbattery BAT1) | $(fbattery BAT2) | $(clock)"

	sleep 15
done
